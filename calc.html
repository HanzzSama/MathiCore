<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/calc.css" />
    <title>Saran & Masukan</title>
  </head>
  <body>
    <main class="container">
      <div>
        <div class="tittle-container">
          <h3>saran & masukan pengguna</h3>
        </div>
        <main class="list-saran">
          <div id="saranContainer"></div>
        </main>
      </div>
    </main>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        getDocs,
        deleteDoc,
        doc,
      } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

      // Konfigurasi Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyBZniBUYSoX0KX4CtFHebD7PKiTrmfUwZw",
        authDomain: "mathicore-121104.firebaseapp.com",
        projectId: "mathicore-121104",
        storageBucket: "mathicore-121104.firebasestorage.app",
        messagingSenderId: "492202337513",
        appId: "1:492202337513:web:f5698db6a366adf82dbc78",
        measurementId: "G-QDTXYP5LKM",
      };

      // Inisialisasi Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      const saranContainer = document.getElementById("saranContainer");

      // Ambil data dari Firestore
      async function loadSaran() {
        saranContainer.innerHTML = "<p>Mengambil data...</p>";
        const querySnapshot = await getDocs(collection(db, "saran"));
        saranContainer.innerHTML = "";

        if (querySnapshot.empty) {
          saranContainer.innerHTML = "<p>Tidak ada saran tersedia.</p>";
          return;
        }

        let index = 0;
        querySnapshot.forEach((docSnap) => {
          const item = docSnap.data();
          const docId = docSnap.id;

          const section = document.createElement("section");
          section.classList.add("card-saran");
          section.innerHTML = `
            <div>
              <div class="txt-saran">
                <div class="name-saran">
                  <h3>${item.nama}</h3>
                </div>
                <div class="desc-saran">
                  <h4>${item.saran}</h4>
                </div>
                <div class="date-saran">
                  <h6>${item.waktu}</h6>
                </div>
              </div>
              <div class="reply">
                <a href="mailto:${item.email}?subject=Terima kasih atas saran Anda untuk MathiCalc&body=Halo ${item.nama},%0D%0A%0D%0ATerima kasih banyak atas saran dan masukan yang telah Anda berikan kepada tim kami. Kami sangat menghargai waktu dan perhatian Anda dalam membantu pengembangan MathiCalc agar menjadi lebih baik lagi.%0D%0A%0D%0ASemoga Anda tetap mendukung kami di versi berikutnya! ðŸ˜Š%0D%0A%0D%0ASalam hangat,%0D%0ATim MathiCalc">
                <div class="tittle-reply">
                  <i class="bx bxl-gmail"></i>
                  <h6>balas</h6>
                </div>
              </a>
                <button class="delete-saran" data-id="${docId}">
                  <i class="bx bxs-trash-alt"></i>
                  <h6>hapus</h6>
                </button>
              </div>
            </div>
          `;

          saranContainer.appendChild(section);
          index++;
        });

        // Tambahkan event listener untuk tombol hapus
        document.querySelectorAll(".delete-saran").forEach((btn) => {
          btn.addEventListener("click", async (e) => {
            const id = e.currentTarget.getAttribute("data-id");
            if (confirm("Yakin ingin menghapus saran ini?")) {
              await deleteDoc(doc(db, "saran", id));
              alert("Saran berhasil dihapus!");
              loadSaran(); // refresh daftar
            }
          });
        });
      }

      loadSaran();
    </script>
  </body>
</html>
